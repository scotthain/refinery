name: Release the refinery binaries
on:
  push:
    branches:
      - 'shain/action'
  pull_request:
    branches_ignore:
      - main

jobs:
  go-build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Go build
        run |
          GOOS=<< parameters.fos >> \
          GOARCH=<< parameters.arch >> \
          go build -ldflags "-X main.BuildID=${CIRCLE_TAG:-${CIRCLE_SHA1:0:7}}" \
          -o $GOPATH/bin/refinery-<< parameters.os >>-<< parameters.arch >> \
          ./cmd/refinery
      - name: Get Shasum
        run |
          256sum $GOPATH/bin/refinery-<< parameters.os >>-<< parameters.arch >> \
          \> $GOPATH/bin/refinery-<< parameters.os >>-<< parameters.arch >>.checksum

  setup_googleko:
    runs-on: ubuntu-latest
    steps:
      -name: Install ko
      -run: go install github.com/google/ko@latest
